"use strict";class t{constructor(){this.events={}}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}emit(t,e){this.events[t]&&this.events[t].forEach((t=>t(e)))}}class e{constructor(t,e={}){this.text=t;const n=document.getElementById("fontFamily"),i=document.getElementById("fontSize");let o="Arial",s="16px";n&&(o=n.value),i&&(s=i.value),this.attributes={bold:e.bold||!1,italic:e.italic||!1,underline:e.underline||!1,undo:e.undo||!1,redo:e.redo||!1,fontFamily:e.fontFamily||o,fontSize:e.fontSize||s,hyperlink:e.hyperlink||!1}}isBold(){return this.attributes.bold}setBold(t){this.attributes.bold=t}isItalic(){return this.attributes.italic}isUndo(){return this.attributes.undo}isRedo(){return this.attributes.redo}setItalic(t){this.attributes.italic=t}isUnderline(){return this.attributes.underline}setUnderline(t){this.attributes.underline=t}setUndo(t){this.attributes.undo=t}setRedo(t){this.attributes.redo=t}clone(){return new e(this.text,Object.assign({},this.attributes))}hasSameAttributes(t){return this.attributes.bold===t.attributes.bold&&this.attributes.italic===t.attributes.italic&&this.attributes.underline===t.attributes.underline&&this.attributes.undo===t.attributes.undo&&this.attributes.redo===t.attributes.redo&&this.attributes.fontFamily===t.attributes.fontFamily&&this.attributes.fontSize===t.attributes.fontSize&&this.attributes.italic===t.attributes.italic&&this.attributes.underline===t.attributes.underline&&this.attributes.hyperlink===t.attributes.hyperlink}getHyperlink(){return this.attributes.hyperlink||!1}setHyperlink(t){this.attributes.hyperlink=t}}class n extends t{get selectedBlockId(){return this._selectedBlockId}set selectedBlockId(t){if(this._selectedBlockId!==t){this._selectedBlockId=t;const e=this.getCursorOffset(document.querySelector('[id="editor"]')),n=this.getCursorOffset(document.querySelector('[data-id="'+t+'"]'));this.currentOffset=e-n}}constructor(){super(),this.undoStack=[],this.redoStack=[],this.dataIds=[],this.selectAll=!1,this._selectedBlockId=null,this.pieces=[new e("")],this.blocks=[{dataId:"data-id-1734604240404",class:"paragraph-block",alignment:"left",pieces:[new e(" ")]}],this.selectedBlockId="data-id-1734604240404",this.currentOffset=0}getPlainText(){return this.pieces.map((t=>t.text)).join("")}insertAt(t,n,i,o="",s=0,l="",r=""){let d=0,c=[],a=!1,h=0;""===o&&null===o||(h=this.blocks.findIndex((t=>t.dataId===o)),d=this.currentOffset);const u=this.getRangeText(i,i);console.log("run1..",t,i,u);for(let o of this.blocks[h].pieces){const s=d+o.text.length;if(!a&&i<=s){const s=i-d;s>0&&c.push(new e(o.text.slice(0,s),Object.assign({},o.attributes))),c.push(new e(t,{bold:n.bold||!1,italic:n.italic||!1,underline:n.underline||!1,hyperlink:n.hyperlink||!1})),s<o.text.length&&c.push(new e(o.text.slice(s),Object.assign({},o.attributes))),a=!0}else c.push(o.clone());d=s}if(!a){const i=c[c.length-1];i&&i.hasSameAttributes(new e("",{bold:n.bold||!1,italic:n.italic||!1,underline:n.underline||!1,hyperlink:n.hyperlink||!1}))?i.text+=t:c.push(new e(t,{bold:n.bold||!1,italic:n.italic||!1,underline:n.underline||!1,hyperlink:n.hyperlink||!1}))}const g=this.mergePieces(c);this.blocks[h].pieces=g;const m=this.getRangeText(i,i+t.length);if("redo"!==r){0===this.redoStack.filter((t=>t.id===l)).length&&(this.undoStack.push({id:Date.now().toString(),start:i,end:i+t.length,action:"insert",previousValue:u,newValue:m}),this.redoStack=[])}this.emit("documentChanged",this);const p=document.querySelector('[data-id="'+o+'"]');p.focus(),this.setCursorPositionUsingOffset(p,d)}setCursorPositionUsingOffset(t,e){t.focus();const n=window.getSelection();if(!n)return;const i=document.createRange();let o=0;const s=t=>{if(3===t.nodeType){const n=t,s=o+n.length;if(console.log("data",s,n),e>=o&&e<=s)return i.setStart(n,e-o),i.collapse(!0),!0;o=s}else if(1===t.nodeType){const e=Array.from(t.childNodes);for(const t of e)if(s(t))return!0}return!1};s(t),console.log(i,"data"),n.removeAllRanges(),n.addRange(i)}deleteRange(t,n,i="",o=0){if(console.log("runn1 deleteRange() ",t,n,i,o),t===n)return;let s=[],l=0,r=0,d=!1;""===i&&null===i||(r=this.blocks.findIndex((t=>t.dataId===i)),console.log(r,"index action"),l=o);const c=this.getRangeText(t,n);if(console.log("runn1 previousValue",c,"start === offset",t,l),t===l)for(let t of this.blocks[r-1].pieces)s.push(t.clone()),d=!0;for(let i of this.blocks[r].pieces){const o=l+i.text.length;if(o<=t||l>=n)s.push(i.clone());else{const r=l,d=i.text;t>r&&t<o&&s.push(new e(d.slice(0,t-r),Object.assign({},i.attributes))),n<o&&s.push(new e(d.slice(n-r),Object.assign({},i.attributes)))}l=o}console.log(i,"dataId",this.currentOffset,"offset",l,"currentOffset",o);const a=this.mergePieces(s);d?(this.blocks[r-1].pieces=a,console.log("runn1 --- > _data",a),this.blocks[r].pieces=[new e(" ")],this.blocks=this.blocks.filter(((t,e)=>{if(e!==r)return t}))):this.blocks[r].pieces=a,0===a.length&&this.blocks.length>1&&(this.blocks=this.blocks.filter((t=>0!==t.pieces.length)));const h=this.getRangeText(t-1,n-1);console.log(h),this.emit("documentChanged",this)}deleteBlocks(){this.blocks=this.blocks.filter((t=>{if(!this.dataIds.includes(t.dataId))return t})),this.dataIds=[],this.selectAll=!1,0===this.blocks.length&&this.blocks.push({dataId:"data-id-1734604240404",class:"paragraph-block",pieces:[new e(" ")]}),this.emit("documentChanged",this)}getSelectedTextDataId(){const t=window.getSelection();if(!t||0===t.rangeCount)return null;const e=t.getRangeAt(0).startContainer,n=(e.nodeType===Node.TEXT_NODE?e.parentElement:e).closest("[data-id]");return(null==n?void 0:n.getAttribute("data-id"))||null}getAllSelectedDataIds(){var t;const e=window.getSelection();if(!e||0===e.rangeCount)return[];const n=e.getRangeAt(0),i=[],o=document.createNodeIterator(n.commonAncestorContainer,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);let s;for(;s=o.nextNode();)if(n.intersectsNode(s)){const e=s.nodeType===Node.TEXT_NODE?s.parentElement:s,n=null===(t=null==e?void 0:e.closest("[data-id]"))||void 0===t?void 0:t.getAttribute("data-id");n&&!i.includes(n)&&i.push(n)}return this.dataIds=i,i}handleCtrlASelection(){const t=[],e=document.getElementById("editor");if(e){e.querySelectorAll("[data-id]").forEach((e=>{const n=e.getAttribute("data-id");n&&!t.includes(n)&&t.push(n)}))}return this.dataIds=t,console.log("zzz",{dataIds:this.dataIds}),console.log(" run1 id Selected Data IDs:",t),t}getSelectedDataIds(){const t=window.getSelection();if(!t||0===t.rangeCount)return[];const e=t.getRangeAt(0),n=[],i=e.startContainer,o=e.endContainer,s=this.getDataIdFromNode(i),l=this.getDataIdFromNode(o);return s&&!n.includes(s)&&n.push(s),l&&!n.includes(l)&&n.push(l),this.dataIds=n,n}getDataIdFromNode(t){var e;const n=t.nodeType===Node.TEXT_NODE?t.parentElement:t;return(null===(e=null==n?void 0:n.closest("[data-id]"))||void 0===e?void 0:e.getAttribute("data-id"))||null}getCursorOffset(t){const e=window.getSelection();if(!e||0===e.rangeCount)return-1;const n=e.getRangeAt(0);let i=0;const o=t=>{if(t===n.startContainer)return i+=n.startOffset,!0;t.nodeType===Node.TEXT_NODE&&(i+=(t.textContent||"").length);for(const e of Array.from(t.childNodes))if(o(e))return!0;return!1};return o(t),i}formatAttribute(t,n,i,o){console.log(i,"attribute1",t,n);let s=[],l=0,r=-1;""===this.selectedBlockId&&null===this.selectedBlockId||(console.log("ctrlakesathbold",this.selectedBlockId),r=this.blocks.findIndex((t=>t.dataId===this.selectedBlockId)),l=this.currentOffset,console.log(r,"index attribute1",l));for(let d of this.blocks[r].pieces){console.log(d.text.length,"piece.text.length attribute1");const r=l+d.text.length;if(r<=t||l>=n)s.push(d.clone());else{const r=l,c=d.text,a=Math.max(t-r,0),h=Math.min(n-r,c.length);a>0&&s.push(new e(c.slice(0,a),Object.assign({},d.attributes)));const u=new e(c.slice(a,h),Object.assign({},d.attributes));("bold"!==i&&"italic"!==i&&"underline"!==i&&"undo"!==i&&"redo"!==i&&"hyperlink"!==i||"boolean"!=typeof o)&&("fontFamily"!==i&&"fontSize"!==i&&"hyperlink"!==i||"string"!=typeof o)||(u.attributes[i]=o),s.push(u),h<c.length&&s.push(new e(c.slice(h),Object.assign({},d.attributes)))}l=r}const d=this.mergePieces(s);this.blocks[r].pieces=d,this.emit("documentChanged",this)}toggleOrderedList(t,e=1){const n=this.blocks.findIndex((e=>e.dataId===t)),i=this.blocks.find((e=>e.dataId===t));i&&(i.listType="ol"===i.listType?null:"ol",i.listStart=e,this.blocks[n].listType=i.listType,console.log(i,"action -- block ol ",n,this.blocks[n].listType),this.emit("documentChanged",this))}toggleUnorderedList(t){const e=this.blocks.find((e=>e.dataId===t));e&&(e.listType="ul"===e.listType?null:"ul",this.emit("documentChanged",this))}getRangeText(t,e){let n="",i=0;for(const o of this.blocks){for(const s of o.pieces){const o=s.text.length;if(i+o>=t&&i<e){const l=Math.max(0,t-i),r=Math.min(o,e-i);n+=s.text.substring(l,r)}if(i+=o,i>=e)break}if(i>=e)break}return n}undo(){const t=this.undoStack.pop();console.log(t,"action undo"),t&&(this.redoStack.push(t),this.revertAction(t))}redo(){const t=this.redoStack.pop();console.log(t,"action redo"),t&&(this.undoStack.push(t),this.applyAction(t))}revertAction(t){switch(t.action){case"bold":this.toggleBoldRange(t.start,t.end,t.id);break;case"italic":this.toggleItalicRange(t.start,t.end,t.id);break;case"underline":this.toggleUnderlineRange(t.start,t.end,t.id);break;case"insert":console.log("insert... delete"),this.deleteRange(t.start,t.end,this.selectedBlockId,this.currentOffset)}}applyAction(t){switch(t.action){case"bold":this.toggleBoldRange1(t.start,t.end,t.id);break;case"italic":this.toggleItalicRange1(t.start,t.end,t.id);break;case"underline":this.toggleUnderlineRange1(t.start,t.end,t.id);break;case"insert":console.log("insert... insert"),this.insertAt(t.newValue||"",{},t.start,this.selectedBlockId,this.currentOffset,t.id,"redo")}}toggleBoldRange1(t,e,n=""){const i=this.isRangeEntirelyAttribute(t,e,"bold");this.formatAttribute(t,e,"bold",!i)}toggleItalicRange1(t,e,n=""){const i=this.isRangeEntirelyAttribute(t,e,"italic");this.formatAttribute(t,e,"italic",!i)}toggleUnderlineRange1(t,e,n=""){const i=this.isRangeEntirelyAttribute(t,e,"underline");this.formatAttribute(t,e,"underline",!i)}toggleBoldRange(t,e,n=""){const i=this.getRangeText(t,e),o=this.isRangeEntirelyAttribute(t,e,"bold");this.formatAttribute(t,e,"bold",!o);const s=this.getRangeText(t,e);0===this.redoStack.filter((t=>t.id===n)).length&&(this.undoStack.push({id:Date.now().toString(),start:t,end:e,action:"bold",previousValue:i,newValue:s}),this.redoStack=[])}toggleItalicRange(t,e,n=""){const i=this.getRangeText(t,e),o=this.isRangeEntirelyAttribute(t,e,"italic");this.formatAttribute(t,e,"italic",!o);const s=this.getRangeText(t,e);0===this.redoStack.filter((t=>t.id===n)).length&&(this.undoStack.push({id:Date.now().toString(),start:t,end:e,action:"italic",previousValue:i,newValue:s}),this.redoStack=[])}toggleUnderlineRange(t,e,n=""){const i=this.getRangeText(t,e),o=this.isRangeEntirelyAttribute(t,e,"underline");this.formatAttribute(t,e,"underline",!o);const s=this.getRangeText(t,e);0===this.redoStack.filter((t=>t.id===n)).length&&(this.undoStack.push({id:Date.now().toString(),start:t,end:e,action:"underline",previousValue:i,newValue:s}),this.redoStack=[])}toggleUndoRange(t,e,n=""){const i=this.isRangeEntirelyAttribute(t,e,"undo");this.formatAttribute(t,e,"undo",!i)}toggleRedoRange(t,e){const n=this.isRangeEntirelyAttribute(t,e,"redo");this.formatAttribute(t,e,"redo",!n)}isRangeEntirelyAttribute(t,e,n){let i=this.currentOffset,o=!0;if(""!==this.selectedBlockId){const s=this.blocks.findIndex((t=>t.dataId===this.selectedBlockId));console.log(s,"vicky",this.selectedBlockId);for(let l of this.blocks[s].pieces){const s=i+l.text.length;if(s>t&&i<e&&!l.attributes[n]){o=!1;break}i=s}}return o}mergePieces(t){let e=[];for(let n of t){const t=e[e.length-1];t&&t.hasSameAttributes(n)?t.text+=n.text:e.push(n)}return e}findPieceAtOffset(t,e=""){let n=0;if(null!==e&&""!==e)for(let i=0;i<this.blocks.length;i++){let o=this.blocks[i];const s=o.pieces.reduce(((t,e)=>t+e.text.length),0);if(o.dataId==e)for(let e of o.pieces){const i=n+e.text.length;if(t>=n&&t<i)return e;n=i}else n+=s}return null}setFontFamily(t,e,n){this.formatAttribute(t,e,"fontFamily",n)}setFontSize(t,e,n){this.formatAttribute(t,e,"fontSize",n)}setAlignment(t,e){const n=this.blocks.find((t=>t.dataId===e));n&&(n.alignment=t,this.emit("documentChanged",this))}getCursorOffsetInParent(t){var e;const n=document.querySelector(t);if(!n)return null;const i=window.getSelection();if(!i||0===i.rangeCount)return null;const o=i.getRangeAt(0);if(!n.contains(o.startContainer))return null;let s=0,l=null;const r=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,null);let d=null;for(;r.nextNode();){const t=r.currentNode;if(t===o.startContainer){s+=o.startOffset,l=t,d=t.parentElement;break}s+=(null===(e=t.textContent)||void 0===e?void 0:e.length)||0}return{offset:s,childNode:l,innerHTML:d.innerHTML,innerText:d.innerText}}}function i(t){const e=window.getSelection();if(!e||0===e.rangeCount)return null;const n=e.getRangeAt(0),i=n.cloneRange();i.selectNodeContents(t),i.setEnd(n.startContainer,n.startOffset);const o=i.toString().length;i.setEnd(n.endContainer,n.endOffset);return{start:o,end:i.toString().length}}function o(t,e){if(!e)return;let n=0;const i=document.createRange();i.setStart(t,0),i.collapse(!0);const o=[t];let s,l=!1,r=!1;for(;!r&&(s=o.pop());)if(3===s.nodeType){const t=s,o=n+t.length;!l&&e.start>=n&&e.start<=o&&(i.setStart(t,e.start-n),l=!0),l&&e.end>=n&&e.end<=o&&(i.setEnd(t,e.end-n),r=!0),n=o}else if("BR"===s.tagName)l||e.start!==n||(i.setStartBefore(s),l=!0),l&&e.end===n&&(i.setEndBefore(s),r=!0),n++;else{const t=s;let e=t.childNodes.length;for(;e--;)o.push(t.childNodes[e])}const d=window.getSelection();d&&(d.removeAllRanges(),d.addRange(i))}function s(t){const e=i(t.container);return e?[e.start,e.end]:[0,0]}class l{constructor(t,e){this.container=t,this.document=e}render(){const t=i(this.container);this.container.innerHTML="",console.log(this.document.blocks,"action -- block editorview"),this.document.blocks.forEach((t=>{if(""!==t.dataId){let e,n;"ol"===t.listType||"li"===t.listType?(e=document.createElement("ol"),e.setAttribute("start",null==t?void 0:t.listStart.toString())):e="ul"===t.listType?document.createElement("ul"):document.createElement("div"),e.setAttribute("data-id",t.dataId),e.setAttribute("class",t.class),e.style.textAlign=t.alignment||"left","ol"===t.listType||"ul"===t.listType||"li"===t.listType?(n=document.createElement("li"),t.pieces.forEach((t=>{n.appendChild(this.renderPiece(t))})),e.append(n)):t.pieces.forEach((t=>{e.appendChild(this.renderPiece(t))})),this.container.appendChild(e)}})),o(this.container,t)}renderPiece(t){const e=t.text.split("\n");return this.wrapAttributes(e,t.attributes)}wrapAttributes(t,e){const n=document.createDocumentFragment();return t.forEach(((i,o)=>{let s=document.createTextNode(i);if(e.underline){const t=document.createElement("u");t.appendChild(s),s=t}if(e.italic){const t=document.createElement("em");t.appendChild(s),s=t}if(e.bold){const t=document.createElement("strong");t.appendChild(s),s=t}console.log(e,"attribute----1",document.getElementById("fontFamily"));const l=document.getElementById("fontFamily"),r=document.getElementById("fontSize");let d="Arial",c="16px";if(l&&(d=l.value,console.log(d,"Selected Font Family")),r&&(c=r.value,console.log(c,"Selected Font size")),e.hyperlink&&"string"==typeof e.hyperlink){const t=document.createElement("a");t.href=e.hyperlink,t.target="_blank",t.appendChild(s),s=t}const a=document.createElement("span");a.style.fontFamily=e.fontFamily||d,a.style.fontSize=e.fontSize||c,a.appendChild(s),n.appendChild(a),o<t.length-1&&n.appendChild(document.createElement("br"))})),n}}class r extends t{constructor(t){super(),this.container=t,this.setupButtons()}setupButtons(){this.container.querySelectorAll("button").forEach((t=>{t.addEventListener("mousedown",(t=>{t.preventDefault()}))})),this.container.addEventListener("click",(t=>{const e=t.target.closest("button");if(e){const t=e.getAttribute("data-action");t&&this.emit("toolbarAction",t)}}))}updateActiveStates(t){this.container.querySelectorAll("button").forEach((e=>{const n=e.getAttribute("data-action");let i=!1;"bold"===n&&t.bold&&(i=!0),"italic"===n&&t.italic&&(i=!0),"underline"===n&&t.underline&&(i=!0),"undo"===n&&t.undo&&(i=!0),"redo"===n&&t.redo&&(i=!0),e.classList.toggle("active",i)})),this.container.querySelectorAll("select").forEach((e=>{const n=e.getAttribute("data-action");"fontFamily"===n&&t.fontFamily&&(e.value=t.fontFamily),"fontSize"===n&&t.fontSize&&(e.value=t.fontSize)}))}}class d{constructor(t,e,n){this.savedSelection=null,this.editorContainer=t,this.editorView=e,this.document=n}hanldeHyperlinkClick(t,e,n,i,o){const s=this.getCommonHyperlinkInRange(t,e,n,i,o);this.showHyperlinkInput(s)}getCommonHyperlinkInRange(t,e,n,i,o){let s=n,l=0;i&&(l=o.findIndex((t=>t.dataId===i)));const r=o[l].pieces;let d=null;for(let n of r){const i=s+n.text.length;if(i>t&&s<e){const t=n.attributes.hyperlink||null;if(null===d)d=t;else if(d!==t)return null}s=i}return d}showHyperlinkInput(t){const e=document.getElementById("hyperlink-container"),n=document.getElementById("hyperlink-input"),o=document.getElementById("apply-hyperlink"),s=document.getElementById("cancel-hyperlink");if(e&&n&&o&&s){e.style.display="block";const l=window.getSelection();if(l&&l.rangeCount>0){const t=l.getRangeAt(0).getBoundingClientRect();e.style.top=`${t.bottom+window.scrollY+5}px`,e.style.left=`${t.left+window.scrollX}px`}n.value=t||"",this.savedSelection=i(this.editorView.container),this.highlightSelection(),n.focus(),o.onclick=null,s.onclick=null;const r=this.document.dataIds;o.onclick=()=>{const t=n.value.trim();t&&this.applyHyperlink(t,r),e.style.display="none"},console.log("yyy",{outer:this.document.dataIds}),s.onclick=()=>{console.log("yyy",{removeOuter:this.document.dataIds}),this.removeHyperlink(r),e.style.display="none"}}}highlightSelection(){this.removeHighlightSelection();const t=window.getSelection();if(t&&t.rangeCount>0){const e=t.getRangeAt(0),n=document.createElement("span");n.className="temporary-selection-highlight",n.appendChild(e.extractContents()),e.insertNode(n),t.removeAllRanges();const i=document.createRange();i.selectNodeContents(n),t.addRange(i)}}removeHighlightSelection(){var t;const e=null===(t=this.editorContainer)||void 0===t?void 0:t.querySelectorAll("span.temporary-selection-highlight");null==e||e.forEach((t=>{const e=t.parentNode;if(e){for(;t.firstChild;)e.insertBefore(t.firstChild,t);e.removeChild(t)}}))}applyHyperlink(t,e){this.removeHighlightSelection(),o(this.editorView.container,this.savedSelection);const[n,i]=s(this.editorView);n<i&&(console.log("yyy",this.document.blocks),console.log("yyy",this.document.selectedBlockId),console.log("yyy",this.document.dataIds),e.length>1?this.document.blocks.forEach((i=>{if(e.includes(i.dataId)){this.document.selectedBlockId=i.dataId;let e=0;i.pieces.forEach((t=>{e+=t.text.length}));let o=n-e;this.document.formatAttribute(o,e,"hyperlink",t)}})):this.document.formatAttribute(n,i,"hyperlink",t),this.editorView.render(),o(this.editorView.container,this.savedSelection),this.editorView.container.focus()),this.savedSelection=null}removeHyperlink(t){this.removeHighlightSelection(),o(this.editorView.container,this.savedSelection);const[e,n]=s(this.editorView);console.log("yyyy",{remove:this.document.dataIds}),e<n&&(console.log("yyyy",{inside:this.document.dataIds}),t.length>1?this.document.blocks.forEach((n=>{if(t.includes(n.dataId)){this.document.selectedBlockId=n.dataId;let t=0;n.pieces.forEach((e=>{t+=e.text.length}));let i=e-t;this.document.formatAttribute(i,t,"hyperlink",!1)}})):this.document.formatAttribute(e,n,"hyperlink",!1),this.editorView.render(),o(this.editorView.container,this.savedSelection),this.editorView.container.focus()),this.savedSelection=null}showHyperlinkViewButton(t){const e=document.getElementById("hyperlink-container-view"),n=document.getElementById("hyperlink-view-link");if(e&&n){e.style.display="block";const i=window.getSelection();if(i){const t=i.getRangeAt(0).getBoundingClientRect();e.style.top=`${t.bottom+window.scrollY+5}px`,e.style.left=`${t.left+window.scrollX}px`}t&&(n.innerText=t||"",n.href=t||"")}}hideHyperlinkViewButton(){const t=document.getElementById("hyperlink-container-view");t&&(t.style.display="none")}}function c(t){return a((new DOMParser).parseFromString(t,"text/html").body,{bold:!1,italic:!1,underline:!1})}function a(t,n){let i=Object.assign({},n);const o=[];if(t instanceof HTMLElement)"STRONG"!==t.tagName&&"B"!==t.tagName||(i.bold=!0),"EM"!==t.tagName&&"I"!==t.tagName||(i.italic=!0),"U"===t.tagName&&(i.underline=!0),t.childNodes.forEach((t=>{console.log({child:t}),o.push(...a(t,i))}));else if(t instanceof Text){const n=t.nodeValue||"";""!==n.trim()&&o.push(new e(n,Object.assign({},i)))}return o}const h={bold:'<svg \n                xmlns="http://www.w3.org/2000/svg" \n                width="18" \n                height="18" \n                viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;">\n                <title>Bold</title>\n                <path d="M17.061 11.22A4.46 4.46 0 0 0 18 8.5C18 6.019 15.981 4 13.5 4H6v15h8c2.481 0 4.5-2.019 4.5-4.5a4.48 4.48 0 0 0-1.439-3.28zM13.5 7c.827 0 1.5.673 1.5 1.5s-.673 1.5-1.5 1.5H9V7h4.5zm.5 9H9v-3h5c.827 0 1.5.673 1.5 1.5S14.827 16 14 16z"></path>\n            </svg>',italic:'<svg \n                xmlns="http://www.w3.org/2000/svg" \n                width="18" \n                height="18" \n                viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;">\n                <title>Italic</title>\n                <path d="M19 7V4H9v3h2.868L9.012 17H5v3h10v-3h-2.868l2.856-10z"></path>\n            </svg>',underline:'<svg \n                    xmlns="http://www.w3.org/2000/svg" \n                    width="18" height="18" \n                    viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;">\n                    <title>Underline</title>\n                    <path d="M5 18h14v2H5zM6 4v6c0 3.309 2.691 6 6 6s6-2.691 6-6V4h-2v6c0 2.206-1.794 4-4 4s-4-1.794-4-4V4H6z"></path>\n                </svg>',subscript:'<svg \n                xmlns="http://www.w3.org/2000/svg" \n                    width="18" height="18" \n                    viewBox="0 0 24 24">\n                    <title>Subscript</title>\n                    <path fill="currentColor" d="M19 20v-3h3v-1h-3v-1h4v3h-3v1h3v1zM5.875 18l4.625-7.275L6.2 4h2.65l3.1 5h.1l3.075-5H17.8l-4.325 6.725L18.125 18H15.45l-3.4-5.425h-.1L8.55 18z"/>\n                </svg>',superscript:'<svg \n                    xmlns="http://www.w3.org/2000/svg" \n                    width="18" \n                    height="18" \n                    viewBox="0 0 24 24">\n                    <title>Superscript</title>\n                    <path fill="currentColor" d="M19 9V6h3V5h-3V4h4v3h-3v1h3v1zM5.875 20l4.625-7.275L6.2 6h2.65l3.1 5h.1l3.075-5H17.8l-4.325 6.725L18.125 20H15.45l-3.4-5.425h-.1L8.55 20z"/>\n                </svg>',left_align:'<svg \n                    xmlns="http://www.w3.org/2000/svg" \n                    width="18" \n                    height="18" \n                    viewBox="0 0 24 24">\n                    <title>Left Align</title>\n                    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="1.5" d="M4.5 12h8m-8 6.25h15m-15-12.5h15"/>\n                </svg>',center_align:'<svg \n                    xmlns="http://www.w3.org/2000/svg" \n                    width="18" \n                    height="18" \n                    viewBox="0 0 24 24">\n                    <title>Center Align</title><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M8 12h8M6 18h12"/>\n                </svg>',right_align:'<svg \n                    xmlns="http://www.w3.org/2000/svg" \n                    width="18" \n                    height="18" \n                    viewBox="0 0 24 24">\n                    <title>Right Align</title><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="1.5" d="M19.5 12h-8m8-6.25h-15m15 12.5h-15"/></svg>',justify:'<svg \n                xmlns="http://www.w3.org/2000/svg" \n                width="18" \n                height="18" \n                viewBox="0 0 20 20">\n                <title>Justify</title><path fill="currentColor" d="M2 4.25a.75.75 0 0 1 .75-.75h14.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 4.25m0 5a.75.75 0 0 1 .75-.75h14.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 9.25m.75 4.25a.75.75 0 0 0 0 1.5h14.5a.75.75 0 0 0 0-1.5z"/>\n            </svg>',bullet_list:'<svg \n                    xmlns="http://www.w3.org/2000/svg" \n                    width="18" \n                    height="18" \n                    viewBox="0 0 16 16">\n                    <title>Bullet List</title><path fill="currentColor" d="M2 4.5a1 1 0 1 0 0-2a1 1 0 0 0 0 2M2 9a1 1 0 1 0 0-2a1 1 0 0 0 0 2m1 3.5a1 1 0 1 1-2 0a1 1 0 0 1 2 0M5.5 3a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zM5 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 5 8m.5 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1z"/></svg>',numbered_list:'<svg \n                    xmlns="http://www.w3.org/2000/svg" \n                    width="18" \n                    height="18" \n                    viewBox="0 0 512 512">\n                    <title>Numbererd List</title>\n                    <path fill="currentColor" d="M184 80h288v32H184zm0 160h288v32H184zm0 160h288v32H184zm-64-240V40H56v32h32v88zM56 262.111V312h80v-32H91.777L136 257.889V192H56v32h48v14.111zM56 440v32h80V344H56v32h48v16H80v32h24v16z"/>\n                </svg>',insert_table:'<svg \n                    xmlns="http://www.w3.org/2000/svg" \n                    width="18" \n                    height="18" \n                    viewBox="0 0 20 20">\n                    <title>Insert Table</title>\n                    <path fill="currentColor" d="M1.364 5.138v12.02h17.272V5.138zM.909 1.5h18.182c.502 0 .909.4.909.895v15.21a.9.9 0 0 1-.91.895H.91c-.503 0-.91-.4-.91-.895V2.395C0 1.9.407 1.5.91 1.5m5.227 1.759c0-.37.306-.671.682-.671s.682.3.682.671v13.899c0 .37-.305.67-.682.67a.676.676 0 0 1-.682-.67zm6.96-.64c.377 0 .682.3.682.67v4.995h4.91c.377 0 .683.301.683.672c0 .37-.306.671-.682.671l-4.911-.001v3.062h5.002c.377 0 .682.3.682.671c0 .37-.305.671-.682.671h-5.002v3.158a.676.676 0 0 1-.682.671a.676.676 0 0 1-.681-.67l-.001-3.159H1.001a.676.676 0 0 1-.682-.67c0-.371.305-.672.682-.672h11.413V9.626L.909 9.627a.676.676 0 0 1-.682-.671c0-.37.306-.671.682-.671l11.505-.001V3.289c0-.37.306-.67.682-.67"/>\n                </svg>',insert_layout:'<svg \n                    xmlns="http://www.w3.org/2000/svg" \n                    width="18" \n                    height="18" \n                    viewBox="0 0 256 256">\n                    <title>Insert Layout</title>\n                    <path fill="currentColor" d="M216 42H40a14 14 0 0 0-14 14v144a14 14 0 0 0 14 14h176a14 14 0 0 0 14-14V56a14 14 0 0 0-14-14M40 54h176a2 2 0 0 1 2 2v42H38V56a2 2 0 0 1 2-2m-2 146v-90h60v92H40a2 2 0 0 1-2-2m178 2H110v-92h108v90a2 2 0 0 1-2 2"/>\n                </svg>',heading:'<svg \n                xmlns="http://www.w3.org/2000/svg" \n                width="18" \n                height="18" \n                viewBox="0 0 24 24">\n                <title>Heading</title>\n                <path fill="currentColor" d="M17 11V4h2v17h-2v-8H7v8H5V4h2v7z"/>\n            </svg>',hyperlink:'<svg \n                xmlns="http://www.w3.org/2000/svg" \n                width="18" \n                height="18" \n                viewBox="0 0 24 24">\n                <title>Hyperlink</title>\n                <path fill="currentColor" d="M14.78 3.653a3.936 3.936 0 1 1 5.567 5.567l-3.627 3.627a3.936 3.936 0 0 1-5.88-.353a.75.75 0 0 0-1.18.928a5.436 5.436 0 0 0 8.12.486l3.628-3.628a5.436 5.436 0 1 0-7.688-7.688l-3 3a.75.75 0 0 0 1.06 1.061z"/>\n                <path fill="currentColor" d="M7.28 11.153a3.936 3.936 0 0 1 5.88.353a.75.75 0 0 0 1.18-.928a5.436 5.436 0 0 0-8.12-.486L2.592 13.72a5.436 5.436 0 1 0 7.688 7.688l3-3a.75.75 0 1 0-1.06-1.06l-3 3a3.936 3.936 0 0 1-5.567-5.568z"/>\n            </svg>',image:'<svg \n            xmlns="http://www.w3.org/2000/svg" \n            width="18" \n            height="18" \n            viewBox="0 0 16 16">\n            <title>Insert Image</title>\n            <path fill="currentColor" d="M6 5a2 2 0 1 1-4 0a2 2 0 0 1 4 0m9-4a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zm-3.448 6.134l-3.76 2.769a.5.5 0 0 1-.436.077l-.087-.034l-1.713-.87L1 11.8V14h14V9.751zM15 2H1v8.635l4.28-2.558a.5.5 0 0 1 .389-.054l.094.037l1.684.855l3.813-2.807a.5.5 0 0 1 .52-.045l.079.05L15 8.495z"/>\n        </svg>'};class u{constructor(t,i){var o,s,a,u,g;this.savedSelection=null;const{mainEditorId:m,toolbarId:p}=function(t,e){const n="editor",i="toolbar",o=["Arial","Times New Roman","Courier New","Verdana"],s=["12px","14px","16px","18px","20px"],l=document.getElementById(t);if(!l)throw new Error("Editor element not found or incorrect element type.");const r=document.createElement("div");r.className="toolbar",r.id=i,l.appendChild(r);const d=document.createElement("div");d.id=n,d.contentEditable="true",l.appendChild(d);const c={bold:"<strong>B</strong>",italic:"<em>I</em>",underline:"<u>U</u>",hyperlink:"&#128279;",alignLeft:"&#8676;",alignCenter:"&#8596;",alignRight:"&#8677;",unorderedList:"&#8226;",orderedList:"1.",fontFamily:"fontFamily",fontSize:"fontSize",subscript:"X<sub>2</sub>",superscript:"X<sup>2</sup>",justify:"&#8644;",insert_table:"&#8866;",insert_layout:"&#10064;",heading:"H",image:"&#128247;",colors:"&#127912;"},a=[{feature:"alignLeft",id:"alignLeft",icon:h.left_align},{feature:"alignCenter",id:"alignCenter",icon:h.center_align},{feature:"alignRight",id:"alignRight",icon:h.right_align},{feature:"unorderedList",id:"unorderedList",icon:h.bullet_list},{feature:"orderedList",id:"orderedList",icon:h.numbered_list}],u=(t,e)=>{const n=document.createElement("select");return n.dataset.action=t,n.id=t,e.forEach((t=>{const e=document.createElement("option");e.value=t,e.textContent=t,n.appendChild(e)})),n};e.features.forEach((t=>{if("fontFamily"===t){const t=u("fontFamily",o);r.appendChild(t)}else if("fontSize"===t){const t=u("fontSize",s);r.appendChild(t)}else if(-1!==a.map((t=>t.feature)).indexOf(t)){const e=a.filter((e=>e.feature===t));let n=null;(null==e?void 0:e.length)>0&&(n=e[0]);const i=document.createElement("button");i.id=t,i.dataset.action=t;const o=(null==n?void 0:n.icon)||"";i.innerHTML=o,r.appendChild(i),r.appendChild(i)}else{const e=document.createElement("button");e.dataset.action=t,e.innerHTML=c[t]||t,e.id=t,e.title=t.split("_").map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join(" "),r.appendChild(e)}}));const g=document.createElement("div");g.id="hyperlink-container",g.style.display="none";const m=document.createElement("input");m.type="text",m.id="hyperlink-input",m.placeholder="Enter a URL...";const p=document.createElement("button");p.id="apply-hyperlink",p.textContent="Link";const f=document.createElement("button");f.id="cancel-hyperlink",f.textContent="Unlink",g.appendChild(m),g.appendChild(p),g.appendChild(f),r.appendChild(g);const b=document.createElement("div");b.id="hyperlink-container-view",b.style.display="none";const k=document.createElement("span");k.id="hyperlink-view-span",k.innerHTML="Visit URL : ";const v=document.createElement("a");return v.id="hyperlink-view-link",v.href="",v.target="_blank",b.appendChild(k),b.appendChild(v),r.appendChild(b),{mainEditorId:n,toolbarId:i}}(t,i);if(this.editorContainer=document.getElementById(m)||null,this.toolbarContainer=document.getElementById(p)||null,!this.editorContainer||!this.toolbarContainer)throw new Error("Editor element not found or incorrect element type.");this.document=new n,this.editorView=new l(this.editorContainer,this.document),this.toolbarView=new r(this.toolbarContainer),this.hyperlinkHandler=new d(this.editorContainer,this.editorView,this.document),this.currentAttributes={bold:!1,italic:!1,underline:!1,undo:!1,redo:!1,hyperlink:!1},this.manualOverride=!1,this.lastPiece=null,this.toolbarView.on("toolbarAction",((t,e=[])=>this.handleToolbarAction(t,e))),this.document.on("documentChanged",(()=>this.editorView.render())),this.editorContainer.addEventListener("keydown",(t=>this.handleKeydown(t))),this.editorContainer.addEventListener("keyup",(()=>this.syncCurrentAttributesWithCursor())),document.addEventListener("mouseup",(()=>{const t=this.document.getAllSelectedDataIds();console.log("run1 id mouseup Selected text is inside element with data-id:",t),console.log(this.document.dataIds,"this.document.dataIds mouseup run1 id")})),null===(o=document.getElementById("fontFamily"))||void 0===o||o.addEventListener("change",(t=>{const e=t.target.value,[n,i]=this.getSelectionRange();this.document.dataIds.length>1?this.document.blocks.forEach((t=>{if(this.document.dataIds.includes(t.dataId)){console.log(document.getElementById(t.dataId)),console.log(t.dataId,this.document.dataIds,"attribute1"),this.document.selectedBlockId=t.dataId;let i=0;t.pieces.forEach((t=>{i+=t.text.length}));let o=n-i;this.document.setFontFamily(o,i,e)}})):this.document.setFontFamily(n,i,e)})),null===(s=document.getElementById("fontSize"))||void 0===s||s.addEventListener("change",(t=>{const e=t.target.value,[n,i]=this.getSelectionRange();this.document.dataIds.length>1?this.document.blocks.forEach((t=>{if(this.document.dataIds.includes(t.dataId)){this.document.selectedBlockId=t.dataId;let i=0;t.pieces.forEach((t=>{i+=t.text.length}));let o=n-i;this.document.setFontSize(o,i,e)}})):this.document.setFontSize(n,i,e)})),null===(a=document.getElementById("alignLeft"))||void 0===a||a.addEventListener("click",(()=>{this.document.dataIds.forEach((t=>this.document.setAlignment("left",t)))})),null===(u=document.getElementById("alignCenter"))||void 0===u||u.addEventListener("click",(()=>{this.document.dataIds.forEach((t=>this.document.setAlignment("center",t)))})),null===(g=document.getElementById("alignRight"))||void 0===g||g.addEventListener("click",(()=>{this.document.dataIds.forEach((t=>this.document.setAlignment("right",t)))})),this.editorContainer.addEventListener("keydown",(t=>{if((t.ctrlKey||t.metaKey)&&!t.altKey){const e=t.key.toLowerCase();if(["b","i","u","h"].includes(e)){t.preventDefault();let n="b";switch(e){case"b":n="bold";break;case"i":n="italic";break;case"u":n="underline";break;case"h":n="hyperlink"}this.handleToolbarAction(n)}if("z"===e?(t.preventDefault(),this.document.undo()):"y"===e&&(t.preventDefault(),this.document.redo()),"a"===e){const t=this.document.handleCtrlASelection();this.document.selectAll=!0,console.log("Selected text is inside element with data-id:",t)}"l"===t.key?(t.preventDefault(),this.document.setAlignment("left",this.document.selectedBlockId)):"e"===t.key?(t.preventDefault(),this.document.setAlignment("center",this.document.selectedBlockId)):"r"===t.key&&(t.preventDefault(),this.document.setAlignment("right",this.document.selectedBlockId)),console.log("undo",this.document.undoStack,"redo",this.document.redoStack)}})),document.addEventListener("selectionchange",this.handleSelectionChange.bind(this)),this.document.emit("documentChanged",this.document),this.editorContainer.addEventListener("paste",(t=>{var n,i;t.preventDefault();const o=null===(n=t.clipboardData)||void 0===n?void 0:n.getData("text/html"),[s,l]=this.getSelectionRange();l>s&&this.document.deleteRange(s,l);let r=[];if(o)r=c(o);else{const n=(null===(i=t.clipboardData)||void 0===i?void 0:i.getData("text/plain"))||"";r=[new e(n,Object.assign({},this.currentAttributes))]}let d=s;for(const t of r)this.document.insertAt(t.text,Object.assign({},t.attributes),d,this.document.selectedBlockId),d+=t.text.length;this.setCursorPosition(d)})),this.editorContainer.addEventListener("dragover",(t=>{t.preventDefault()})),this.editorContainer.addEventListener("drop",(t=>{var n,i;t.preventDefault();const o=null===(n=t.dataTransfer)||void 0===n?void 0:n.getData("text/html"),[s,l]=this.getSelectionRange();l>s&&this.document.deleteRange(s,l);let r=[];if(o)r=c(o);else{const n=(null===(i=t.dataTransfer)||void 0===i?void 0:i.getData("text/plain"))||"";r=[new e(n,Object.assign({},this.currentAttributes))]}let d=s;for(const t of r)this.document.insertAt(t.text,Object.assign({},t.attributes),d,this.document.selectedBlockId),d+=t.text.length;this.setCursorPosition(d)}))}getSelectionRange(){const t=i(this.editorView.container);return t?[t.start,t.end]:[0,0]}handleToolbarAction(t,e=[]){const[n,i]=this.getSelectionRange();switch(console.log(t,"action---"),t){case"orderedList":this.document.dataIds.map(((t,e)=>this.document.toggleOrderedList(t,e+1)));break;case"unorderedList":this.document.dataIds.map((t=>this.document.toggleUnorderedList(t)))}if(n<i)switch(t){case"bold":this.document.dataIds.length>1?this.document.blocks.forEach((t=>{if(this.document.dataIds.includes(t.dataId)){this.document.selectedBlockId=t.dataId;let e=0;t.pieces.forEach((t=>{e+=t.text.length}));let i=n-e;this.document.toggleBoldRange(i,e)}})):this.document.toggleBoldRange(n,i);break;case"italic":this.document.dataIds.length>1?this.document.blocks.forEach((t=>{if(this.document.dataIds.includes(t.dataId)){this.document.selectedBlockId=t.dataId;let e=0;t.pieces.forEach((t=>{e+=t.text.length}));let i=n-e;this.document.toggleItalicRange(i,e)}})):this.document.toggleItalicRange(n,i);break;case"underline":this.document.dataIds.length>1?this.document.blocks.forEach((t=>{if(this.document.dataIds.includes(t.dataId)){this.document.selectedBlockId=t.dataId;let e=0;t.pieces.forEach((t=>{e+=t.text.length}));let i=n-e;this.document.toggleUnderlineRange(i,e)}})):this.document.toggleUnderlineRange(n,i);break;case"undo":this.document.undo();break;case"redo":this.document.redo();break;case"hyperlink":this.hyperlinkHandler.hanldeHyperlinkClick(n,i,this.document.currentOffset,this.document.selectedBlockId,this.document.blocks)}else this.currentAttributes[t]=!this.currentAttributes[t],this.manualOverride=!0;console.log("undo",this.document.undoStack,"redo",this.document.redoStack),this.toolbarView.updateActiveStates(this.currentAttributes)}handleSelectionChange(){var t;this.syncCurrentAttributesWithCursor();const e=window.getSelection();if(console.log("run1 id ---- ",e),!e||0===e.rangeCount)return void console.log("run1 id ---- if1");e&&!0===e.isCollapsed&&(console.log("run1 id ---- if2"),this.document.dataIds=[]);const n=null===(t=e.getRangeAt(0).startContainer.parentElement)||void 0===t?void 0:t.closest("[data-id]");n&&n instanceof HTMLElement&&(this.document.selectedBlockId=n.getAttribute("data-id")||null)}handleKeydown(t){var n,i,o,s,l,r,d,c,a;const[h,u]=this.getSelectionRange();let g=u;if("Enter"===t.key){console.log("blocks---\x3e>",this.document.blocks),t.preventDefault();const u=`data-id-${Date.now()}`;if("ol"===(null===(n=this.document.blocks[this.document.blocks.length-1])||void 0===n?void 0:n.listType)||"ul"===(null===(i=this.document.blocks[this.document.blocks.length-1])||void 0===i?void 0:i.listType)||"li"===(null===(o=this.document.blocks[this.document.blocks.length-1])||void 0===o?void 0:o.listType)){const t=null===(s=this.document.blocks[this.document.blocks.length-2])||void 0===s?void 0:s.listType,n=null===(l=this.document.blocks[this.document.blocks.length-1])||void 0===l?void 0:l.listType;let i="",o=1,h=n;console.log("action -",t,n),"ol"===n?(o=null===(r=this.document.blocks[this.document.blocks.length-1])||void 0===r?void 0:r.listStart,o+=1,h="li",i=null===(d=this.document.blocks[this.document.blocks.length-1])||void 0===d?void 0:d.dataId):"li"===n&&(o=null===(c=this.document.blocks[this.document.blocks.length-1])||void 0===c?void 0:c.listStart,o+=1,i=null===(a=this.document.blocks[this.document.blocks.length-1])||void 0===a?void 0:a.parentId),console.log("vk11   0",this.getCurrentCursorBlock()),this.document.blocks.push({dataId:u,class:"paragraph-block",pieces:[new e(" ")],listType:h,parentId:i,listStart:"ol"===n||"li"===n?o:""})}else if(console.log("vk11   1",this.getCurrentCursorBlock()),null!==this.getCurrentCursorBlock()){const{remainingText:t,piece:n}=this.extractTextFromDataId(this.getCurrentCursorBlock().toString()),i=" "+t;let o=this.document.blocks;if(console.log({extractedContent:i}),i.length>0){const s=t.split(" ");let l=[];console.log("extractTextFromDataId run if0",s,n),""!==s[0]||void 0!==s[1]?1===n.length?(l=[new e(i,n[0].attributes)],console.log("extractTextFromDataId run if1",s,n,"_pieces",l)):(console.log("extractTextFromDataId run else1",s,n),l.push(new e(" "+s[0]+" ",n[0].attributes)),n.length>=2&&(console.log("extractTextFromDataId run if2"),n.forEach(((t,e)=>{0!==e&&l.push(t)})))):(console.log("extractTextFromDataId run else0"),l=[new e(" ")]),console.log(" extractTextFromDataId pieces",l,n),o=this.addBlockAfter(this.document.blocks,this.getCurrentCursorBlock().toString(),{dataId:u,class:"paragraph-block",pieces:l}),console.log("schenerio1"),g=h+i.length-1}else o=this.addBlockAfter(this.document.blocks,this.getCurrentCursorBlock().toString(),{dataId:u,class:"paragraph-block",pieces:[new e(" ")]});this.document.blocks=o,console.log("vk11",this.document.blocks," updatedBlock",o)}else console.log("jagdiii 1"),this.document.blocks.push({dataId:u,class:"paragraph-block",pieces:[new e(" ")]});this.syncCurrentAttributesWithCursor(),this.editorView.render(),this.setCursorPosition(g+1,u),g>h&&this.document.deleteRange(h,g,this.document.selectedBlockId,this.document.currentOffset)}else if("Backspace"===t.key){t.preventDefault();const e=window.getSelection();if(console.log("selection",e," ",this.document.dataIds.length,"run1 id1 length rn1",this.document.dataIds,"this.document.selectedBlockId",this.document.selectedBlockId),this.document.dataIds.length>=1&&this.document.selectAll&&(console.log(this.document.dataIds,"run1 id this.document.dataIds rn1"),this.document.deleteBlocks(),this.setCursorPosition(h+1)),h===u&&h>0){this.document.deleteRange(h-1,h,this.document.selectedBlockId,this.document.currentOffset),this.setCursorPosition(h-1),this.document.blocks.findIndex((t=>t.dataId===this.document.selectedBlockId));const t=document.querySelector(`[data-id="${this.document.selectedBlockId}"]`);if(console.log(t," _block index action r1 1"),null===t){let t=0;const e=this.document.blocks.map(((e,n)=>(void 0===(null==e?void 0:e.listType)&&null===(null==e?void 0:e.listType)||("ol"===(null==e?void 0:e.listType)?(t=1,e.listStart=1):"li"===(null==e?void 0:e.listType)&&(t+=1,e.listStart=t)),e)));console.log(e," _block index action----- rn1 2"),this.document.emit("documentChanged",this)}}else u>h&&(console.log("else if rn1 3",u,h),this.document.deleteRange(h,u,this.document.selectedBlockId,this.document.currentOffset),this.setCursorPosition(h+1))}else 1!==t.key.length||t.ctrlKey||t.metaKey||t.altKey?"Delete"===t.key&&(t.preventDefault(),h===u?(this.document.deleteRange(h,h+1,this.document.selectedBlockId),this.setCursorPosition(h)):u>h&&(this.document.deleteRange(h,u,this.document.selectedBlockId),this.setCursorPosition(h))):(t.preventDefault(),u>h&&this.document.deleteRange(h,u,this.document.selectedBlockId,this.document.currentOffset),this.document.insertAt(t.key,Object.assign({},this.currentAttributes),h,this.document.selectedBlockId,this.document.currentOffset),this.setCursorPosition(h+1))}extractTextFromDataId(t){const e=window.getSelection();if(!e||0===e.rangeCount)return{remainingText:"",piece:null};const n=e.getRangeAt(0),i=n.startContainer;let o="";const s=this.document.blocks.filter((e=>{if(e.dataId===t)return e})),l=document.querySelector(`[data-id="${t}"]`),r=this.document.getCursorOffsetInParent(`[data-id="${t}"]`);let d=[],c=0;if(s[0].pieces.forEach(((t,e)=>{o+=t.text,(null==r?void 0:r.innerText)===t.text&&(c=e,d.push(t))})),s[0].pieces.length>1&&s[0].pieces.forEach(((t,e)=>{c<e&&d.push(t)})),console.log("v11, element",l,"_block",s,r,d),!l)return console.error(`Element with data-id "${t}" not found.`),{remainingText:"",piece:null};if(!l.contains(i))return console.error(`Cursor is not inside the element with data-id "${t}".`),{remainingText:"",piece:null};const a=o,h=null==r?void 0:r.offset;console.log("v11 fullText",a,o,h,n);const u=a.slice(h),g=a.slice(0,h);return l.textContent=g,console.log("v11 Extracted text:",u),console.log("v11 Updated element content:",g),{remainingText:u,piece:d}}getCurrentCursorBlock(){const t=window.getSelection();if(!t||0===t.rangeCount)return null;const e=t.getRangeAt(0).startContainer,n=e.nodeType===Node.TEXT_NODE?e.parentElement:e,i=null==n?void 0:n.closest("[data-id]");return(null==i?void 0:i.getAttribute("data-id"))||null}addBlockAfter(t,e,n){const i=t.findIndex((t=>t.dataId===e));if(-1===i)return console.error(`Block with dataId "${e}" not found.`),t;return[...t.slice(0,i+1),n,...t.slice(i+1)]}syncCurrentAttributesWithCursor(){const[t,e]=this.getSelectionRange();if(t===e){const e=this.document.findPieceAtOffset(t,this.document.selectedBlockId);if(e){e!==this.lastPiece&&(this.manualOverride=!1,this.lastPiece=e),this.manualOverride||(this.currentAttributes={bold:e.attributes.bold,italic:e.attributes.italic,underline:e.attributes.underline,hyperlink:e.attributes.hyperlink||!1,fontFamily:e.attributes.fontFamily,fontSize:e.attributes.fontSize},this.toolbarView.updateActiveStates(this.currentAttributes));const t=null==e?void 0:e.attributes.hyperlink;t&&"string"==typeof t?this.hyperlinkHandler.showHyperlinkViewButton(t):this.hyperlinkHandler.hideHyperlinkViewButton()}else this.manualOverride||(this.currentAttributes={bold:!1,italic:!1,underline:!1,hyperlink:!1},this.toolbarView.updateActiveStates(this.currentAttributes)),this.lastPiece=null}}setCursorPosition(t,e=""){if(""===e)this.editorView.container.focus();else{document.querySelector('[data-id="'+e+'"]').focus()}const n=window.getSelection();if(!n)return;const i=document.createRange();let o=0;const s=[this.editorView.container];let l;for(;l=s.pop();)if(3===l.nodeType){const e=l,n=o+e.length;if(t>=o&&t<=n){i.setStart(e,t-o),i.collapse(!0);break}o=n}else if("BR"===l.tagName){if(t===o){i.setStartBefore(l),i.collapse(!0);break}o++}else{const t=l;let e=t.childNodes.length;for(;e--;)s.push(t.childNodes[e])}n.removeAllRanges(),n.addRange(i)}}window.TextIgniter=u,exports.TextIgniter=u;
